<!-- create by Antony Tom -->
{% extends 'company/src/html/base.html' %}
{% block content %}
{% load static %}

<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
<style>
    .form-control {
        border: 2px solid #6c757d;
        transition: border-color 0.3s;
    }

    .form-control:focus {
        border-color: #007bff;
    }

    .save-button {
        background-color: #007bff;
        border-color: #007bff;
        color: #fff;
        margin-right: 1rem;
    }


    .save-button:hover {
        background-color: #fff;
        color: #007bff;
    }
</style>

<body style="background-color: rgba(176, 199, 205, 0.4);">
    <form method="POST" action="" class="p-5" enctype="multipart/form-data" novalidate
        id="forms">
        {% csrf_token %}
        <div class="body-wrapper">
            <div class="container-fluid">
                <div class="col-md-3">
                    <a class="text-dark" style="font-size: 1.5rem;">Add Sales Invoice</a>
                </div>


                <div class="d-flex mt-2">
                    <select style="color: black;" class="form-control border-dark bg-light me-2" id="partySelect" name="item_unit" required onchange="updatePartyDetails()">
                        <option value="">Select a Party</option>
                        {% for i in Party %}
                            <option value="{{ i.party_name|upper }}">{{ i.party_name|upper }}</option>
                        {% endfor %}
                        <option id="load_new_unit" hidden value=""></option>
                    </select>
                
                    <button id="modal_closing" type="button" class="btn bg-warning" data-bs-toggle="modal" data-bs-target="#exampleModal" data-bs-whatever="@mdo">
                        <span class="fa fa-plus"></span>
                    </button>
                
                    <input style="color: black;" class="form-control border-dark bg-light ms-2 " type="number" placeholder="Phone No" autocomplete="off" name="contact" id="partyPhone" readonly required>
                    <input style="color: black;" class="form-control border-dark bg-light ms-2 " type="text" placeholder="Address" autocomplete="off" name="contact" id="partyAddress" readonly required>
                </div>
                
                <label for="" id="partyBalance">Balance Amount: </label>
                

                <div class="d-flex mt-2">
                    <input style="color: black;" class="form-control border-dark bg-light  fw-bolder" type="number"
                        placeholder="Invoice No" autocomplete="off" name="invoiceno" required>
                    <input style="color: black;" class="form-control border-dark bg-light ms-2 " type="date"
                        placeholder="Date" autocomplete="off" name="date" id="current-date" required>
                        <select style="color: black;" class="form-control border-dark bg-light me-2 ms-2" id="stateOfSupply"
                        name="state_of_supply" required onchange="updateTaxOptions()">
                    <option value="">State of supply</option>
                    <option value="state">State</option>
                    <option value="other_state">Other State</option>
                   
                </select>
                </div>



                <!-- .............................................  TABLE 1  ..................................................... -->


                <div class="row " style="margin-top: 5rem;">
                    <div class="col-md-12 table-responsive-md ">
                      <table class="table table-bordered text-dark" style="width: 103%; background-color: white" id="item_table" onclick='toggleDateInput()' >
                        <thead>
                          <tr>
                            <th class="text-right">#</th>
                            <th>Item</th>
                            <th class="text-right">Hsn</th>
                            <th class="text-right">Qty</th>
                            <th class="text-right">Price</th>
                            <th class="text-right">Discount</th>
                            <th class="text-right">Tax</th>
                            <th class="text-right">Total</th>
                          </tr>
                        </thead>
                        <tbody>
                          <tr id="row1">
                              <td style="width: 5%;">
                                  
                              </td>
                              
                              <td  style="width: 13%;">
                                <div class="d-flex">
                                   <select
                                        class='form-control bg-light text-dark border-0 item_select itm'
                                        name='item[]' id='item1'>
                                        <option value=" " selected disabled>Select Item</option>
                                        {% for i in item %}
                                          <option value="{{i.item_name}}">{{ i.item_name  }} </option>
                                        {% endfor %}
                                    </select></div>
                              </td>
            
                              <td style="width: 13%;" class='text-right'><input type='number' id='hsn1'
                                class=' text-right hsn form-control bg-light text-dark' name='hsn[]'>
                        </td>
                        <td>
                        <input type='number' id='qty1' class='text-right qty form-control bg-light text-dark' name='quantity[]'>
                        </td>
                              <td style="width: 10%;" class='text-right'><input type='number' id='rate1'
                                      class=' text-right rate form-control bg-light text-dark' name='rate[]'
                                      value='0'>
                              </td>
                              <td style="width: 9%;" class='text-right text-dark'><input type='number' id='discount1'
                                      class=' text-right discount bg-light text-dark form-control' name='discount[]'
                                      value='0'>
                              </td>
                              <td style="width: 12%;" class='text-right '> <select name='tax[]' id='tax1'
                                      class='form-control bg-light text-dark  text-right border-0 tax' onclick="toggleDateInput()">
                                      <optgroup class="text-center" label="GST">
                                        <option value="0" selected></option>
                                        <option value="0">0% GST(0%)</option>
                                        <option value="3">3.0% GST(3%)</option>
                                        <option value="5">5.0% GST(5%)</option>
                                        <option value="12">12.0% GST(12%)</option>
                                        <option value="18">18.0% GST(18%)</option>
                                        <option value="28">28.0% GST(28%)</option>
                                      </optgroup>
                                      <optgroup  class="text-center" label="IGST">
                                        <option value="0">0% IGST(0%)</option>
                                        <option value="3">3.0% IGST(3%)</option>
                                        <option value="5">5.0% IGST(5%)</option>
                                        <option value="12">12.0% IGST(12%)</option>
                                        <option value="18">18.0% IGST(18%)</option>
                                        <option value="28">28.0% IGST(28%)</option>             
                                        </optgroup>
                                  </select></td>
                              <td style="display: none;">
                                  <input type="text" name='taxamount' id="taxamount1"
                                      class=" taxamount text-dark" />
                              </td>
                              <td style="width: 15%;" class='text-right'><input type='number' id='amount1'
                                      class=' text-right form-control amount bg-light text-dark' name='amount[]'
                                      value='0.00'></td>
                              <td class='text-center'>
              <button type='button' id='del_btn1'
                      class='btn btn-transparent text-danger btn-sm btn-outline-danger rounded-circle delete-row'
                      style='width:30px'>X</button>
              <button type='button' class='btn btn-transparent text-primary btn-sm btn-outline-primary rounded-circle clone-row' data-row=1 style='width:30px'><i class="fa fa-clone"></i>
              </button>
            </td>
            
             </tr>
                  </tbody>
                </table>
                <button type="button" class="btn btn-sm text-white" style="background-color: rgb(210, 132, 30);" id="add-row"><i class="fa-solid  fa fa-plus rounded"></i></button>
              </div>
            </div>
            
                  <div class="row border-bottom pb-5">
                    <div class="col-sm-5 d-flex flex-column mt-auto">
            
                        <label for="">Description</label>
                        <textarea name="customer_note" id="" cols="8" rows="8"
                            placeholder=" "></textarea>
                    </div>
                    <div class="col-sm-6 " >
                        <table class=" table  text-dark" style="background-color: white">
                            <tr>
                                <td>Sub Total</td>
                                <td></td>
                                <td><input type="number" id="subtotal" name="subtotal" step="any" value="0.00"
                                        class="bg-transparent border-0 text-right subtotal text-dark"></td>
                            </tr>
                            <tr style="display: none;" id="tr_igst">
                                <td>IGST</td>
                                <td></td>
                                <td><input type="number" id='igst' name="igst" step="any" value="0.00"
                                        class="form-control bg-transparent border-0 text-right igst  text-dark" ></td>
                            </tr>
                            <tr style="display: none;" id="tr_cgst">
                                <td>CGST</td>
                                <td></td>
                                <td><input type="number" id='cgst' name="cgst" step="any" value="0.00"
                                        class="form-control bg-transparent border-0 text-right cgst text-dark" ></td>
                            </tr>
                            <tr style="display: none;" id="tr_sgst">
                                <td>SGST</td>
                                <td></td>
                                <td><input type="number" id='sgst' name="sgst" step="any" value="0.00"
                                        class="form-control bg-transparent border-0 text-right sgst  text-dark" ></td>
                            </tr>
                            <tr>
                                <td>Tax Amount</td>
                                <td></td>
                                <td><input type="number" id="total_taxamount" name="total_taxamount" step="any" value="0.00" 
                                    class="total_taxamount form-control bg-transparent border-0 text-right  text-dark"></td>
                            </tr>
                            
                            <tr>
                              <td>Adjustment </td>
                              
                              <td><input type="hidden" id="shipping_charge" name="shipping_charge" step="any" value="0.00" 
                                  class="form-control bg-transparent border-0 text-right shipping_charge  "></td>
                                  <td><input type="number" class="form-control  bg-transparent border-0  text-dark" id="shipping" step="any" value="0"> </td>
                          </tr>
                            
                            <tr>
                                <th>Total ( &#x20B9; )</th>
                                <th></th>
                                <th><input type="number" id="grandtotal" name="grandtotal" step="any" value="0.00" 
                                        class="form-control bg-transparent border-0 text-right grandtotal  text-dark"></th>
                            </tr>
                        </table>
                    </div>
                </div>


                    <div class="col-md-5 mt-4">
                        <input type="submit" class="btn btn-primary save-button" name="save_and_new" value="Save&New">
                        <input type="submit" class="btn btn-primary save-button" name="save" value="Save">
                    </div>

                </div>
            </div>
    </form>


</body>




<script>
    function updatePartyDetails() {
        // Get the selected party name
        var selectedParty = document.getElementById('partySelect').value;

        // Assume you have an endpoint to fetch party details, replace 'your-api-endpoint' with the actual endpoint
        var endpoint = '/api/party-details/' + selectedParty; // Update the endpoint accordingly

        // Fetch party details
        fetch(endpoint)
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(data => {
                // Update the input fields with the fetched details
                document.getElementById('partyPhone').value = data.contact;
                document.getElementById('partyAddress').value = data.address;
                document.getElementById('partyBalance').innerText = 'Balance Amount: ' + data.openingbalance;
            })
            .catch(error => console.error('Error fetching party details:', error));
    }




// current date

    function formatDate(date) {
        const year = date.getFullYear();
        const month = (date.getMonth() + 1).toString().padStart(2, '0');
        const day = date.getDate().toString().padStart(2, '0');
        return `${year}-${month}-${day}`;
    }

    // Get the current date
    const currentDateInput = document.getElementById("current-date");
    const currentDate = new Date();

    // Format the date as "YYYY-MM-DD" and set it in the input field
    currentDateInput.value = formatDate(currentDate);


function updateTaxOptions() {
    // Get the selected state from the "State of supply" dropdown
    var selectedState = document.getElementById('stateOfSupply').value;

    // Get the tax select element
    var taxSelect = document.getElementById('tax1');

    // Get the optgroup element for GST and IGST
    var gstOptgroup = taxSelect.querySelector('optgroup[label="GST"]');
    var igstOptgroup = taxSelect.querySelector('optgroup[label="IGST"]');

    // Show or hide the GST and IGST options based on the selected state
    if (selectedState === 'state') {
        gstOptgroup.style.display = 'block';
        igstOptgroup.style.display = 'none';
    } else if (selectedState === 'other_state') {
        gstOptgroup.style.display = 'none';
        igstOptgroup.style.display = 'block';
    } else {
        gstOptgroup.style.display = 'none';
        igstOptgroup.style.display = 'none';
    }

    if (selectedState === 'state') {
        $('#tr_cgst, #tr_sgst').show();
        $('#tr_igst').hide();
    } else {
        $('#tr_cgst, #tr_sgst').hide();
        $('#tr_igst').show();
    }
}


</script>


<script>
    var rowCount = 1;
    $(document).ready(function () {
      // Counter for row IDs
    
      // Function to calculate the row amount
      function calculateRowAmount(row) {
        var qty = parseFloat(row.find('.qty').val());
        var rate = parseFloat(row.find('.rate').val());
        var tax = parseFloat(row.find('.tax').val());
        var discount = parseFloat(row.find('.discount').val());
    
        var rowAmount = (qty * rate) - discount;
        var taxAmount = (rowAmount * tax) / 100;
    
        row.find('.amount').val(rowAmount.toFixed(2));
        row.find('.taxamount').val(taxAmount.toFixed(2));
        
        return rowAmount;
        calculateTaxAmount();
      }
    
      // Function to calculate the subtotal
      function calculateSubtotal() {
        var subtotal = 0;
        $('#item_table tbody tr').each(function () {
          subtotal += calculateRowAmount($(this));
        });
        $('#subtotal').val(subtotal.toFixed(2));
      }
    
    // Function to calculate the grand total
    function calculateGrandTotal() {
      var grandTotal = 0;
      var totalTaxAmount = 0;
    
      $('#item_table tbody tr').each(function () {
        var rowAmount = calculateRowAmount($(this));
        grandTotal += rowAmount;
        var taxAmount = parseFloat($(this).find('.taxamount').val());
        grandTotal += taxAmount;
        totalTaxAmount += taxAmount;
      });
      var shippingCharges = parseFloat($('#shipping').val());
      grandTotal += shippingCharges;
    
      $('#grandtotal').val(grandTotal.toFixed(2));
      $('#total_taxamount').val(totalTaxAmount.toFixed(2));
    }
    
      $('#item_table').on('change', '.tax', function () {
        var row = $(this).closest('tr');
        calculateRowAmount(row);
        calculateSubtotal();
        calculateGrandTotal();
      });
    
      $('#add-row').click(function () {
        rowCount++; // Increment row counter
        var newRow = `
          <tr id='row${rowCount}'>
            <td></td>
            <td style="width: 9%;">
              <div>
                <select class='form-control bg-light text-dark  border-0 item_select itm' name='item[]' id='item${rowCount}'>
                  <option value=" " selected disabled>Select Item</option>
                  {% for i in item %}
                    <option value="{{i.item_name}}">{{ i.item_name }}</option>
                  {% endfor %}
                </select>
              </div>
            </td>
    
            
            <td style="width: 14%;" class='text-right'>
              <input type='number' id='hsn${rowCount}' class='text-right bg-light text-dark hsn form-control' name='hsn[]'>
            </td>
    
            
            <td style="width: 9%;" class='text-right'>
              <input type='number' id='qty${rowCount}' class='text-right bg-light text-dark qty form-control' name='quantity[]' value='0'>
            </td>
            
            <td style="width: 12%;" class='text-right'>
              <input type='number' id='rate${rowCount}' class='text-right bg-light text-dark rate form-control' name='rate[]' value='0'>
            </td>
            
            <td style="width: 9%;" class='text-right'>
              <input type='number' id='discount${rowCount}' class='text-right bg-light text-dark discount form-control' name='discount[]' value='0'>
            </td>
            
            <td style="width: 14%;" class='text-right'>
              <select name='tax[]'  id='tax${rowCount}' class='form-control bg-light text-dark text-right border-0 tax' onclick=' toggleDateInput()'>
                <optgroup class="text-center" label="GST">
                                <option value="0">0% GST(0%)</option>
                                <option value="3">3.0% GST(3%)</option>
                                <option value="5">5.0% GST(5%)</option>
                                <option value="12">12.0% GST(12%)</option>
                                <option value="18">18.0% GST(18%)</option>
                                <option value="28">28.0% GST(28%)</option>
                              </optgroup>
                              <optgroup  class="text-center" label="IGST">
                               
                                <option value="0">0% IGST(0%)</option>
                                <option value="3">3.0% IGST(3%)</option>
                                <option value="5">5.0% IGST(5%)</option>
                                <option value="12">12.0% IGST(12%)</option>
                                <option value="18">18.0% IGST(18%)</option>
                                <option value="28">28.0% IGST(28%)</option>             
                                </optgroup>
              </select>
            </td>
            
            <td style="display: none;">
              <input type="text" name='taxamount' id="taxamount${rowCount}" class="form-control bg-light text-dark taxamount" />
            </td>
            
            <td style="width: 25%;" class='text-right'>
              <input type='number' id='amount${rowCount}' class='text-right bg-light text-dark form-control amount' name='amount[]' value='0.00'>
            </td>
            
            <td class='text-center'>
      <button type='button' id='del_btn${rowCount}' class='btn btn-transparent text-danger btn-sm btn-outline-danger rounded-circle delete-row' style='width:30px'>X</button>
      <button type='button' class='btn btn-transparent text-primary btn-sm btn-outline-primary rounded-circle clone-row' data-row='${rowCount}' style='width:30px'><i class="fa fa-clone"></i></button>
    </td>
    
          </tr>
        `;
      $('#item_table tbody').append(newRow);
        toggleDateInput();
        calculateSubtotal();
        calculateGrandTotal();
      });
      $('#item_table').on('click', '.delete-row', function () {
        $(this).closest('tr').remove();
        calculateSubtotal();
        calculateGrandTotal();
        calculateTaxAmount();
      });
      $('#srcofsupply').on('change', function () {
      var row = $(this).closest('tr');
      calculateRowAmount(row);
      calculateSubtotal();
      calculateGrandTotal();
      toggleDateInput();
      calculateTaxAmount();
    
      // Calculate total tax amount and its IGST amount
      var totalTaxAmount = 0;
      var totalIGSTAmount = 0;
    
      $('#item_table tbody tr').each(function () {
        var tax = $(this).find('.tax').val();
        var amount = $(this).find('.amount').val();
    
        var taxAmount = amount * (tax / 100);
        totalTaxAmount += taxAmount;
    
        if (tax.startsWith('IGST')) {
          totalIGSTAmount += taxAmount;
        }
      });
    
      // Update the total tax amount and its IGST amount in the UI
      $('#total_taxamount').val(totalTaxAmount.toFixed(2));
      $('#total_igstamount').val(totalIGSTAmount.toFixed(2));
    });
    
      $(document).ready(function() {
        var row = $(this).closest('tr');
        calculateRowAmount(row);
        calculateSubtotal();
        calculateGrandTotal();
        toggleDateInput();
        calculateTaxAmount();
    });
      // Input change event for quantity, rate, and discount
      $('#item_table').on('input', '.qty, .rate, .discount,.tax', function () {
        var row = $(this).closest('tr');
        calculateRowAmount(row);
        calculateSubtotal();
        calculateGrandTotal();
        toggleDateInput();
        calculateTaxAmount();
      });
    
      $('#shipping').on('input', function () {
        var shippingAmount = parseFloat($(this).val());5
        $('#shipping_charge').val(shippingAmount.toFixed(2));
        calculateGrandTotal();
      });
    
    
    
      // Add an event listener to the fields in the item table
    $('#item_table').on('click', '.item_select, .acnt, .rate, .qty, .tax, .discount', function () {
      var row = $(this).closest('tr');
      var taxElement = row.find('.tax');
    
      var checkbox = document.getElementById("srcofsupply");
      var vale = checkbox.value;
    
      if (vale === "[KL] Kerala") {
        taxElement.find('optgroup[label="GST"]').show();
        taxElement.find('optgroup[label="IGST"]').hide();
      } else {
        taxElement.find('optgroup[label="GST"]').hide();
        taxElement.find('optgroup[label="IGST"]').show();
      }
    });
    
    // Event handler for clone button
    $('#item_table').on('click', '.clone-row', function () {
      var row = $(this).closest('tr');
      var clonedRow = row.clone(); // Clone the current row
      var newRowId = 'row' + rowCount; // Generate a new ID for the cloned row
      clonedRow.attr('id', newRowId); // Set the new ID for the cloned row
    
      // Clone the options for tax, account, and item
      var currentItem = row.find('.item_select').val();
      clonedRow.find('.item_select').val(currentItem);
      var currentAccount = row.find('.acnt').val();
      clonedRow.find('.acnt').val(currentAccount);
      var currentTax = row.find('.tax').val();
      clonedRow.find('.tax').val(currentTax);
    
      rowCount++; // Increment row counter
    
      $('#item_table tbody').append(clonedRow);
      var row = $(this).closest('tr');
      calculateRowAmount(row);
      calculateSubtotal();
      calculateGrandTotal();
      toggleDateInput();
      calculateTaxAmount();
      toggleDateInput();
    });
    
    
           
    
    });
function calculateTaxAmount() {
    var checkbox = document.getElementById("srcofsupply");
    var srcofsupply = checkbox.value; // Replace with the actual value of srcofsupply
    var companyState = "[KL] Kerala"; // Replace with the actual value of company state

    var subtotal = parseFloat(document.getElementById("subtotal").value) || 0.0;
    var shipping = parseFloat(document.getElementById("shipping").value) || 0.0;
    var tax = parseFloat(document.getElementById("total_taxamount").value) || 0.0;

    var tax_rate = 0.0; // Default tax rate for IGST
    if (srcofsupply === companyState) {
        tax_rate = tax; // Tax rate for CGST/SGST
    }

    var total_taxamount = tax_rate;

    var cgst = 0.00;
    var sgst = 0.00;
    var igst = 0.00;

    if (srcofsupply === companyState) {
        cgst = total_taxamount / 2;
        sgst = total_taxamount / 2;
    } else {
        igst = tax;
    }

    document.getElementById("cgst").value = cgst.toFixed(2);
    document.getElementById("sgst").value = sgst.toFixed(2);
    document.getElementById("igst").value = igst.toFixed(2);

    if (srcofsupply === companyState) {
        document.getElementById("tr_igst").style.display = "none";
        document.getElementById("tr_cgst").style.display = "";
        document.getElementById("tr_sgst").style.display = "";
    } else {
        document.getElementById("tr_igst").style.display = "";
        document.getElementById("tr_cgst").style.display = "none";
        document.getElementById("tr_sgst").style.display = "none";
    }

    document.getElementById("total_taxamount").value = total_taxamount.toFixed(2);
    var grandtotal = subtotal + total_taxamount + shipping;
    document.getElementById("grandtotal").value = grandtotal.toFixed(2);
}

// Call the function initially on page load
calculateTaxAmount();

// Add event listeners to update tax amounts when subtotal or shipping changes
document.getElementById("subtotal").addEventListener("input", calculateTaxAmount);
document.getElementById("shipping").addEventListener("input", calculateTaxAmount);
document.getElementById("total_taxamount").addEventListener("input", calculateTaxAmount);

        
    
    function toggleDateInput() {
          var checkbox = document.getElementById("srcofsupply");
          var vale=checkbox.value;
          
          for (var i = 1; i <= rowCount; i++) {
            var taxElement = $('#tax' + i);
    
            if (vale === "[KL] Kerala") {
                taxElement.find('optgroup[label="GST"]').show();
                taxElement.find('optgroup[label="IGST"]').hide();
            } else {
                taxElement.find('optgroup[label="GST"]').hide();
                taxElement.find('optgroup[label="IGST"]').show();
            }
        }
      }
    
      function test(taxamount) {
            console.log('test333');
            console.log(taxamount)
            d = 0;
            var checkbox = document.getElementById("srcofsupply");
            var vale=checkbox.value;
            console.log(pos)
            console.log('state')
            console.log(state)
            console.log('state')
            console.log('----------')
            if ( vale === "[KL] Kerala") {
                console.log(pos);
                console.log(state);
                console.log(taxamount);
                gst = taxamount / 2;
                console.log(gst);
                $('#cgst').val(parseFloat(gst.toFixed(2)));
                $('#sgst').val(parseFloat(gst.toFixed(2)));
                $('#igst').val(parseFloat(d.toFixed(2)));
                
                // document.getElementById('tr_cgst').style= ('display: flex');
                
                // document.getElementById('tr_sgst').style= ('display: flex');
                // document.getElementById('tr_igst').style= ('display: none');
    
               
            }
            else{
                gst = taxamount ;
                console.log(gst);
                $('#cgst').val(parseFloat(d.toFixed(2)));
                $('#sgst').val(parseFloat(d.toFixed(2)));
                $('#igst').val(parseFloat(gst.toFixed(2)));
            }
            var checkbox = document.getElementById("srcofsupply");
            var vale=checkbox.value;
            var pos= "[KL] Kerala"
            if (vale==pos){
    
            }
    
            if (vale !=  "[KL] Kerala") {
                console.log(pos);
                console.log(state);
                document.getElementById('tr_cgst').style=('display: none');
                document.getElementById('tr_sgst').style= ('display: none');
                document.getElementById('tr_igst').style= ('display: block');
            }
            else{
                document.getElementById('tr_cgst').style=('display: block');
                document.getElementById('tr_sgst').style= ('display: block');
                document.getElementById('tr_igst').style= ('display: none');
            }
        }
    
    </script>
    
    

    <script>
        $(document).ready(function () {
      
      
            var roinc = 0
            console.log("ajax");
            // var place = document.getElementById('pos').value;
      
            $(document).on('click', '#item1', function () {
                select = $('#item1').val();
                customer = $('#customer_sel').val();
                console.log(select);
                console.log(customer);
                $.ajax({
                    type: "GET",
                    url: "{% url 'itemdata_vendor_credit' %}",
                    data: {
                        id: select,
                        cust: customer
                    },
                    success: function (response) {
                        console.log(response)
                        data = response.rate
      
                        data1 = response.gst
                        data2 = response.igst
                        data3 = response.pos
                        data4=response.place
                        data5 = response.hsn
                        document.getElementById('rate1').value = data
                        document.getElementById('hsn1').value = data5
      
                        if (data3 == '{{ company.state }}') {
                            document.getElementById('tgst1').innerHTML = data1 + ' % GST';
                            document.getElementById('tgst1').value = data1
                        }
                        document.getElementById('tigst1').innerHTML = data2 + ' % IGST';
                        document.getElementById('tigst1').value = data2
      
                    }
                });
      
            });
            // console.log('pos:'+place_of_supply);
            $(document).on('click', '#item2', function () {
                select = $('#item2').val();
                customer = $('#customer_sel').val();
                console.log(select);
                console.log(customer);
                $.ajax({
                    type: "GET",
                    url: "{% url 'itemdata_vendor_credit' %}",
                    data: {
                        id: select,
                        cust: customer
                    },
                    success: function (response) {
                        console.log(response)
                        data = response.rate
                        data1 = response.gst
                        data2 = response.igst
                        data3 = response.pos
                        data4 = response.hsn
                        document.getElementById('rate2').value = data
                        document.getElementById('hsn2').value = data4
      
                        if (data3 == '{{ company.state }}') {
                            document.getElementById('tgst2').innerHTML = data1 + ' % GST';
                            document.getElementById('tgst2').value = data1
                        }
                        document.getElementById('tigst2').innerHTML = data2 + ' % IGST';
                        document.getElementById('tigst2').value = data2
      
                    }
                });
      
            });
      
            $(document).on('click', '#item3', function () {
                select = $('#item3').val();
                customer = $('#customer_sel').val();
                console.log(select);
                console.log(customer);
                $.ajax({
                    type: "GET",
                    url: "{% url 'itemdata_vendor_credit' %}",
                    data: {
                        id: select,
                        cust: customer
                    },
                    success: function (response) {
                        console.log(response)
                        data = response.rate
                        data1 = response.gst
                        data2 = response.igst
                        data3 = response.pos
                        data4 = response.hsn
                        document.getElementById('rate3').value = data
                        document.getElementById('hsn3').value = data4
      
                        if (data3 == '{{ company.state }}') {
                            document.getElementById('tgst3').innerHTML = data1 + ' % GST';
                            document.getElementById('tgst3').value = data1
                        }
                        document.getElementById('tigst3').innerHTML = data2 + ' % IGST';
                        document.getElementById('tigst3').value = data2
      
                    }
                });
      
            });
      
            $(document).on('click', '#item4', function () {
                select = $('#item4').val();
                customer = $('#customer_sel').val();
                console.log(select);
                console.log(customer);
                $.ajax({
                    type: "GET",
                    url: "{% url 'itemdata_vendor_credit' %}",
                    data: {
                        id: select,
                        cust: customer
                    },
                    success: function (response) {
                        console.log(response)
                        data = response.rate
                        data1 = response.gst
                        data2 = response.igst
                        data3 = response.pos
                        data4 = response.hsn
                        document.getElementById('hsn4').value = data4
                        document.getElementById('rate4').value = data
      
                        if (data3 == '{{ company.state }}') {
                            document.getElementById('tgst4').innerHTML = data1 + ' % GST';
                            document.getElementById('tgst4').value = data1
                        }
                        document.getElementById('tigst4').innerHTML = data2 + ' % IGST';
                        document.getElementById('tigst4').value = data2
      
                    }
                });
      
            });
      
            $(document).on('click', '#item5', function () {
                select = $('#item5').val();
                customer = $('#customer_sel').val();
                console.log(select);
                console.log(customer);
                $.ajax({
                    type: "GET",
                    url: "{% url 'itemdata_vendor_credit' %}",
                    data: {
                        id: select,
                        cust: customer
                    },
                    success: function (response) {
                        console.log(response)
                        data = response.rate
                        data1 = response.gst
                        data2 = response.igst
                        data3 = response.pos
                        data4 = response.hsn
                        document.getElementById('hsn5').value = data4
                        document.getElementById('rate5').value = data
      
                        if (data3 == '{{ company.state }}') {
                            document.getElementById('tgst5').innerHTML = data1 + ' % GST';
                            document.getElementById('tgst5').value = data1
                        }
                        document.getElementById('tigst5').innerHTML = data2 + ' % IGST';
                        document.getElementById('tigst5').value = data2
      
                    }
                });
      
            });
      
            $(document).on('click', '#item6', function () {
                select = $('#item6').val();
                customer = $('#customer_sel').val();
                console.log(select);
                console.log(customer);
                $.ajax({
                    type: "GET",
                    url: "{% url 'itemdata_vendor_credit' %}",
                    data: {
                        id: select,
                        cust: customer
                    },
                    success: function (response) {
                        console.log(response)
                        data = response.rate
                        data1 = response.gst
                        data2 = response.igst
                        data3 = response.pos
                        data4 = response.hsn
                        document.getElementById('hsn6').value = data4
                        document.getElementById('rate6').value = data
      
                        if (data3 == '{{ company.state }}') {
                            document.getElementById('tgst6').innerHTML = data1 + ' % GST';
                            document.getElementById('tgst6').value = data1
                        }
                        document.getElementById('tigst6').innerHTML = data2 + ' % IGST';
                        document.getElementById('tigst6').value = data2
      
                    }
                });
      
            });
      
            $(document).on('click', '#item7', function () {
                select = $('#item7').val();
                customer = $('#customer_sel').val();
                console.log(select);
                console.log(customer);
                $.ajax({
                    type: "GET",
                    url: "{% url 'itemdata_vendor_credit' %}",
                    data: {
                        id: select,
                        cust: customer
                    },
                    success: function (response) {
                        console.log(response)
                        data = response.rate
                        data1 = response.gst
                        data2 = response.igst
                        data3 = response.pos
                        data4 = response.hsn
                        document.getElementById('hsn7').value = data4
                        document.getElementById('rate7').value = data
      
                        if (data3 == '{{ company.state }}') {
                            document.getElementById('tgst7').innerHTML = data1 + ' % GST';
                            document.getElementById('tgst7').value = data1
                        }
                        document.getElementById('tigst7').innerHTML = data2 + ' % IGST';
                        document.getElementById('tigst7').value = data2
      
                    }
                });
      
            });
      
            $(document).on('click', '#item8', function () {
                select = $('#item8').val();
                customer = $('#customer_sel').val();
                console.log(select);
                console.log(customer);
                $.ajax({
                    type: "GET",
                    url: "{% url 'itemdata_vendor_credit' %}",
                    data: {
                        id: select,
                        cust: customer
                    },
                    success: function (response) {
                        console.log(response)
                        data = response.rate
                        data1 = response.gst
                        data2 = response.igst
                        data3 = response.pos
                        data4 = response.hsn
                        document.getElementById('hsn8').value = data4
                        document.getElementById('rate8').value = data
      
                        if (data3 == '{{ company.state }}') {
                            document.getElementById('tgst8').innerHTML = data1 + ' % GST';
                            document.getElementById('tgst8').value = data1
                        }
                        document.getElementById('tigst8').innerHTML = data2 + ' % IGST';
                        document.getElementById('tigst8').value = data2
      
                    }
                });
      
            });
      
            $(document).on('click', '#item9', function () {
                select = $('#item9').val();
                customer = $('#customer_sel').val();
                console.log(select);
                console.log(customer);
                $.ajax({
                    type: "GET",
                    url: "{% url 'itemdata_vendor_credit' %}",
                    data: {
                        id: select,
                        cust: customer
                    },
                    success: function (response) {
                        console.log(response)
                        data = response.rate
                        data1 = response.gst
                        data2 = response.igst
                        data3 = response.pos
                        data4 = response.hsn
                        document.getElementById('hsn9').value = data4
                        document.getElementById('rate9').value = data
      
                        if (data3 == '{{ company.state }}') {
                            document.getElementById('tgst9').innerHTML = data1 + ' % GST';
                            document.getElementById('tgst9').value = data1
                        }
                        document.getElementById('tigst9').innerHTML = data2 + ' % IGST';
                        document.getElementById('tigst9').value = data2
      
                    }
                });
      
            });
      
            $(document).on('click', '#item10', function () {
                select = $('#item10').val();
                customer = $('#customer_sel').val();
                console.log(select);
                console.log(customer);
                $.ajax({
                    type: "GET",
                    url: "{% url 'itemdata_vendor_credit' %}",
                    data: {
                        id: select,
                        cust: customer
                    },
                    success: function (response) {
                        console.log(response)
                        data = response.rate
                        data1 = response.gst
                        data2 = response.igst
                        data3 = response.pos
                        data4 = response.hsn
                        document.getElementById('hsn10').value = data4
                        document.getElementById('rate10').value = data
      
                        if (data3 == '{{ company.state }}') {
                            document.getElementById('tgst10').innerHTML = data1 + ' % GST';
                            document.getElementById('tgst10').value = data1
                        }
                        document.getElementById('tigst10').innerHTML = data2 + ' % IGST';
                        document.getElementById('tigst10').value = data2
      
                    }
                });
      
            });
      
            $(document).on('click', '#item11', function () {
                select = $('#item11').val();
                customer = $('#customer_sel').val();
                console.log(select);
                console.log(customer);
                $.ajax({
                    type: "GET",
                    url: "{% url 'itemdata_vendor_credit' %}",
                    data: {
                        id: select,
                        cust: customer
                    },
                    success: function (response) {
                        console.log(response)
                        data = response.rate
                        data1 = response.gst
                        data2 = response.igst
                        data3 = response.pos
                        data4 = response.hsn
                        document.getElementById('hsn11').value = data4
                        document.getElementById('rate11').value = data
      
                        if (data3 == '{{ company.state }}') {
                            document.getElementById('tgst11').innerHTML = data1 + ' % GST';
                            document.getElementById('tgst11').value = data1
                        }
                        document.getElementById('tigst11').innerHTML = data2 + ' % IGST';
                        document.getElementById('tigst11').value = data2
      
                    }
                });
      
            });
      
            $(document).on('click', '#item12', function () {
                select = $('#item12').val();
                customer = $('#customer_sel').val();
                console.log(select);
                console.log(customer);
                $.ajax({
                    type: "GET",
                    url: "{% url 'itemdata_vendor_credit' %}",
                    data: {
                        id: select,
                        cust: customer
                    },
                    success: function (response) {
                        console.log(response)
                        data = response.rate
                        data1 = response.gst
                        data2 = response.igst
                        data3 = response.pos
                        data4 = response.hsn
                        document.getElementById('hsn12').value = data4
                        document.getElementById('rate12').value = data
      
                        if (data3 == '{{ company.state }}') {
                            document.getElementById('tgst12').innerHTML = data1 + ' % GST';
                            document.getElementById('tgst12').value = data1
                        }
                        document.getElementById('tigst12').innerHTML = data2 + ' % IGST';
                        document.getElementById('tigst12').value = data2
      
                    }
                });
      
            });
      
            $(document).on('click', '#item13', function () {
                select = $('#item13').val();
                customer = $('#customer_sel').val();
                console.log(select);
                console.log(customer);
                $.ajax({
                    type: "GET",
                    url: "{% url 'itemdata_vendor_credit' %}",
                    data: {
                        id: select,
                        cust: customer
                    },
                    success: function (response) {
                        console.log(response)
                        data = response.rate
                        data1 = response.gst
                        data2 = response.igst
                        data3 = response.pos
                        data4 = response.hsn
                        document.getElementById('hsn13').value = data4
                        document.getElementById('rate13').value = data
      
                        if (data3 == '{{ company.state }}') {
                            document.getElementById('tgst13').innerHTML = data1 + ' % GST';
                            document.getElementById('tgst13').value = data1
                        }
                        document.getElementById('tigst13').innerHTML = data2 + ' % IGST';
                        document.getElementById('tigst13').value = data2
      
                    }
                });
      
            });
      
            $(document).on('click', '#item14', function () {
                select = $('#item14').val();
                customer = $('#customer_sel').val();
                console.log(select);
                console.log(customer);
                $.ajax({
                    type: "GET",
                    url: "{% url 'itemdata_vendor_credit' %}",
                    data: {
                        id: select,
                        cust: customer
                    },
                    success: function (response) {
                        console.log(response)
                        data = response.rate
                        data1 = response.gst
                        data2 = response.igst
                        data3 = response.pos
                        data4 = response.hsn
                        document.getElementById('hsn14').value = data4
                        document.getElementById('rate14').value = data
      
                        if (data3 == '{{ company.state }}') {
                            document.getElementById('tgst14').innerHTML = data1 + ' % GST';
                            document.getElementById('tgst14').value = data1
                        }
                        document.getElementById('tigst14').innerHTML = data2 + ' % IGST';
                        document.getElementById('tigst14').value = data2
      
                    }
                });
      
            });
      
            $(document).on('click', '#item15', function () {
                select = $('#item15').val();
                customer = $('#customer_sel').val();
                console.log(select);
                console.log(customer);
                $.ajax({
                    type: "GET",
                    url: "{% url 'itemdata_vendor_credit' %}",
                    data: {
                        id: select,
                        cust: customer
                    },
                    success: function (response) {
                        console.log(response)
                        data = response.rate
                        data1 = response.gst
                        data2 = response.igst
                        data3 = response.pos
                        data4 = response.hsn
                        document.getElementById('hsn15').value = data4
                        document.getElementById('rate15').value = data
      
                        if (data3 == '{{ company.state }}') {
                            document.getElementById('tgst15').innerHTML = data1 + ' % GST';
                            document.getElementById('tgst15').value = data1
                        }
                        document.getElementById('tigst15').innerHTML = data2 + ' % IGST';
                        document.getElementById('tigst15').value = data2
      
                    }
                });
      
            });
      
            $(document).on('click', '#item16', function () {
                select = $('#item16').val();
                customer = $('#customer_sel').val();
                console.log(select);
                console.log(customer);
                $.ajax({
                    type: "GET",
                    url: "{% url 'itemdata_vendor_credit' %}",
                    data: {
                        id: select,
                        cust: customer
                    },
                    success: function (response) {
                        console.log(response)
                        data = response.rate
                        data1 = response.gst
                        data2 = response.igst
                        data3 = response.pos
                        data4 = response.hsn
                        document.getElementById('hsn16').value = data4
                        document.getElementById('rate16').value = data
      
                        if (data3 == '{{ company.state }}') {
                            document.getElementById('tgst16').innerHTML = data1 + ' % GST';
                            document.getElementById('tgst16').value = data1
                        }
                        document.getElementById('tigst16').innerHTML = data2 + ' % IGST';
                        document.getElementById('tigst16').value = data2
      
                    }
                });
      
            });
      
            $(document).on('click', '#item17', function () {
                select = $('#item17').val();
                customer = $('#customer_sel').val();
                console.log(select);
                console.log(customer);
                $.ajax({
                    type: "GET",
                    url: "{% url 'itemdata_vendor_credit' %}",
                    data: {
                        id: select,
                        cust: customer
                    },
                    success: function (response) {
                        console.log(response)
                        data = response.rate
                        data1 = response.gst
                        data2 = response.igst
                        data3 = response.pos
                        data4 = response.hsn
                        document.getElementById('hsn17').value = data4
                        document.getElementById('rate17').value = data
      
                        if (data3 == '{{ company.state }}') {
                            document.getElementById('tgst17').innerHTML = data1 + ' % GST';
                            document.getElementById('tgst17').value = data1
                        }
                        document.getElementById('tigst17').innerHTML = data2 + ' % IGST';
                        document.getElementById('tigst17').value = data2
      
                    }
                });
      
            });
      
            $(document).on('click', '#item18', function () {
                select = $('#item18').val();
                customer = $('#customer_sel').val();
                console.log(select);
                console.log(customer);
                $.ajax({
                    type: "GET",
                    url: "{% url 'itemdata_vendor_credit' %}",
                    data: {
                        id: select,
                        cust: customer
                    },
                    success: function (response) {
                        console.log(response)
                        data = response.rate
                        data1 = response.gst
                        data2 = response.igst
                        data3 = response.pos
                        data4 = response.hsn
                        document.getElementById('hsn18').value = data4
                        document.getElementById('rate18').value = data
      
                        if (data3 == '{{ company.state }}') {
                            document.getElementById('tgst18').innerHTML = data1 + ' % GST';
                            document.getElementById('tgst18').value = data1
                        }
                        document.getElementById('tigst18').innerHTML = data2 + ' % IGST';
                        document.getElementById('tigst18').value = data2
      
                    }
                });
      
            });
      
            $(document).on('click', '#item19', function () {
                select = $('#item19').val();
                customer = $('#customer_sel').val();
                console.log(select);
                console.log(customer);
                $.ajax({
                    type: "GET",
                    url: "{% url 'itemdata_vendor_credit' %}",
                    data: {
                        id: select,
                        cust: customer
                    },
                    success: function (response) {
                        console.log(response)
                        data = response.rate
                        data1 = response.gst
                        data2 = response.igst
                        data3 = response.pos
                        data4 = response.hsn
                        document.getElementById('hsn19').value = data4
                        document.getElementById('rate19').value = data
      
                        if (data3 == '{{ company.state }}') {
                            document.getElementById('tgst19').innerHTML = data1 + ' % GST';
                            document.getElementById('tgst19').value = data1
                        }
                        document.getElementById('tigst19').innerHTML = data2 + ' % IGST';
                        document.getElementById('tigst19').value = data2
      
                    }
                });
      
            });
      
            $(document).on('click', '#item20', function () {
                select = $('#item20').val();
                customer = $('#customer_sel').val();
                console.log(select);
                console.log(customer);
                $.ajax({
                    type: "GET",
                    url: "{% url 'itemdata_vendor_credit' %}",
                    data: {
                        id: select,
                        cust: customer
                    },
                    success: function (response) {
                        console.log(response)
                        data = response.rate
                        data1 = response.gst
                        data2 = response.igst
                        data3 = response.pos
                        data4 = response.hsn
                        document.getElementById('hsn20').value = data4
                        document.getElementById('rate20').value = data
      
                        if (data3 == '{{ company.state }}') {
                            document.getElementById('tgst20').innerHTML = data1 + ' % GST';
                            document.getElementById('tgst20').value = data1
                        }
                        document.getElementById('tigst20').innerHTML = data2 + ' % IGST';
                        document.getElementById('tigst20').value = data2
      
                    }
                });
      
            });
      
            $(document).on('click', '#item21', function () {
                select = $('#item21').val();
                customer = $('#customer_sel').val();
                console.log(select);
                console.log(customer);
                $.ajax({
                    type: "GET",
                    url: "{% url 'itemdata_vendor_credit' %}",
                    data: {
                        id: select,
                        cust: customer
                    },
                    success: function (response) {
                        console.log(response)
                        data = response.rate
                        data1 = response.gst
                        data2 = response.igst
                        data3 = response.pos
                        data4 = response.hsn
                        document.getElementById('hsn21').value = data4
                        document.getElementById('rate21').value = data
      
                        if (data3 == '{{ company.state }}') {
                            document.getElementById('tgst21').innerHTML = data1 + ' % GST';
                            document.getElementById('tgst21').value = data1
                        }
                        document.getElementById('tigst21').innerHTML = data2 + ' % IGST';
                        document.getElementById('tigst21').value = data2
      
                    }
                });
      
            });
      
      
        });
      </script>
      

{% endblock %}